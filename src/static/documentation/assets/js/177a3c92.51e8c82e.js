"use strict";(self.webpackChunkchicago_crashes_pipeline_docs=self.webpackChunkchicago_crashes_pipeline_docs||[]).push([[952],{4048:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"getting-started/docker-compose","title":"Docker Compose","description":"Launch PostgreSQL, Redis, and the FastAPI service with the bundled Docker Compose stack.","source":"@site/docs/getting-started/docker-compose.md","sourceDirName":"getting-started","slug":"/getting-started/docker-compose","permalink":"/documentation/getting-started/docker-compose","draft":false,"unlisted":false,"editUrl":"https://github.com/MisterClean/chicago-crashes-pipeline/tree/main/docs/getting-started/docker-compose.md","tags":[],"version":"current","lastUpdatedAt":null,"sidebarPosition":3,"frontMatter":{"title":"Docker Compose","sidebar_position":3,"description":"Launch PostgreSQL, Redis, and the FastAPI service with the bundled Docker Compose stack."},"sidebar":"guideSidebar","previous":{"title":"Configuration Reference","permalink":"/documentation/getting-started/configuration"},"next":{"title":"Admin Portal","permalink":"/documentation/user-guides/admin-portal"}}');var i=n(4848),t=n(8453);const r={title:"Docker Compose",sidebar_position:3,description:"Launch PostgreSQL, Redis, and the FastAPI service with the bundled Docker Compose stack."},d=void 0,c={},l=[{value:"Services",id:"services",level:2},{value:"Start the Stack",id:"start-the-stack",level:2},{value:"Environment Overrides",id:"environment-overrides",level:2},{value:"Database Initialization",id:"database-initialization",level:2},{value:"Useful Commands",id:"useful-commands",level:2},{value:"Production Considerations",id:"production-considerations",level:2}];function a(e){const s={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.p,{children:["The repository ships with a Docker Compose file that provisions the complete stack for development or lightweight demos. It builds the FastAPI image from ",(0,i.jsx)(s.code,{children:"docker/Dockerfile"})," and mounts your local source code for instant reloads."]}),"\n",(0,i.jsx)(s.h2,{id:"services",children:"Services"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Service"}),(0,i.jsx)(s.th,{children:"Image"}),(0,i.jsx)(s.th,{children:"Ports"}),(0,i.jsx)(s.th,{children:"Purpose"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"postgres"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"postgis/postgis:15-3.3"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"5432:5432"})}),(0,i.jsxs)(s.td,{children:["PostgreSQL + PostGIS with initialization script ",(0,i.jsx)(s.code,{children:"docker/init.sql"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"redis"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"redis:7-alpine"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"6379:6379"})}),(0,i.jsx)(s.td,{children:"In-memory cache and job coordination"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"app"})}),(0,i.jsx)(s.td,{children:"Built from project root"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"8000:8000"})}),(0,i.jsx)(s.td,{children:"FastAPI application serving the REST API and admin portal"})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"app"})," mounts your local ",(0,i.jsx)(s.code,{children:"src"}),", ",(0,i.jsx)(s.code,{children:"config"}),", and ",(0,i.jsx)(s.code,{children:"logs"})," directories. Code changes refresh automatically thanks to Uvicorn's ",(0,i.jsx)(s.code,{children:"--reload"})," flag in the Compose command."]}),"\n",(0,i.jsx)(s.h2,{id:"start-the-stack",children:"Start the Stack"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"docker compose -f docker/docker-compose.yml up --build\n"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Use ",(0,i.jsx)(s.code,{children:"-d"})," to run in detached mode."]}),"\n",(0,i.jsx)(s.li,{children:"The first build installs Python dependencies inside the image; subsequent runs are fast."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"environment-overrides",children:"Environment Overrides"}),"\n",(0,i.jsxs)(s.p,{children:["Edit the ",(0,i.jsx)(s.code,{children:"environment"})," blocks in ",(0,i.jsx)(s.code,{children:"docker/docker-compose.yml"})," or supply an env file:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"docker compose --env-file .env -f docker/docker-compose.yml up\n"})}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:".env"})," file can reuse the same variables used for local development (",(0,i.jsx)(s.code,{children:"DB_*"}),", ",(0,i.jsx)(s.code,{children:"CHICAGO_API_TOKEN"}),", etc.)."]}),"\n",(0,i.jsx)(s.h2,{id:"database-initialization",children:"Database Initialization"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"docker/init.sql"})," creates the ",(0,i.jsx)(s.code,{children:"chicago_crashes"})," database and enables PostGIS. If you need a clean reset:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"docker compose -f docker/docker-compose.yml down -v\n"})}),"\n",(0,i.jsxs)(s.p,{children:["This removes the ",(0,i.jsx)(s.code,{children:"postgres_data"})," and ",(0,i.jsx)(s.code,{children:"redis_data"})," volumes."]}),"\n",(0,i.jsx)(s.h2,{id:"useful-commands",children:"Useful Commands"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Tail API logs\ndocker compose -f docker/docker-compose.yml logs -f app\n\n# Run migrations inside the container\ndocker compose -f docker/docker-compose.yml exec app alembic upgrade head\n\n# Open a psql shell\ndocker compose -f docker/docker-compose.yml exec postgres psql -U postgres -d chicago_crashes\n"})}),"\n",(0,i.jsx)(s.h2,{id:"production-considerations",children:"Production Considerations"}),"\n",(0,i.jsx)(s.p,{children:"The provided Compose file targets local development. For production:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Supply strong credentials via environment variables."}),"\n",(0,i.jsxs)(s.li,{children:["Disable the ",(0,i.jsx)(s.code,{children:"--reload"})," flag and mount volumes read-only or bake the code into the image."]}),"\n",(0,i.jsx)(s.li,{children:"Front the API with a reverse proxy (e.g., NGINX or a cloud load balancer) for TLS termination."}),"\n",(0,i.jsx)(s.li,{children:"Add health-check monitoring and metrics scraping."}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>d});var o=n(6540);const i={},t=o.createContext(i);function r(e){const s=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(t.Provider,{value:s},e.children)}}}]);