"use strict";(self.webpackChunkchicago_crashes_pipeline_docs=self.webpackChunkchicago_crashes_pipeline_docs||[]).push([[610],{1367:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/files/database_service-f7f331a29645e60440cbae0bfdd0f4c8.py"},1417:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/files/sync_service-c16a924486d547b722476f732c442fc5.py"},4541:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/files/jobs-75a8fe6d30f5120c125872c9e42feaf8.py"},6537:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/files/crashes-5ed5af231e2bfc2aee75ee4160e6d629.py"},7238:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"agents/data-engineer-examples","title":"Data Engineer Agent - Usage Examples","description":"This document provides real-world examples of how to use the Data Engineer Agent for the Chicago Traffic Crash Data Pipeline.","source":"@site/docs/agents/data-engineer-examples.md","sourceDirName":"agents","slug":"/agents/data-engineer-examples","permalink":"/documentation/agents/data-engineer-examples","draft":false,"unlisted":false,"editUrl":"https://github.com/MisterClean/chicago-crashes-pipeline/tree/main/docs/agents/data-engineer-examples.md","tags":[],"version":"current","lastUpdatedAt":1765653251000,"frontMatter":{}}');var r=s(4848),t=s(8453);const a={},l="Data Engineer Agent - Usage Examples",d={},o=[{value:"Overview",id:"overview",level:2},{value:"Example 1: Optimize ETL Performance",id:"example-1-optimize-etl-performance",level:2},{value:"Scenario",id:"scenario",level:3},{value:"Task",id:"task",level:3},{value:"Agent Workflow",id:"agent-workflow",level:3},{value:"Expected Outcome",id:"expected-outcome",level:3},{value:"Example 2: Add New Data Source (Traffic Signals)",id:"example-2-add-new-data-source-traffic-signals",level:2},{value:"Scenario",id:"scenario-1",level:3},{value:"Task",id:"task-1",level:3},{value:"Agent Workflow",id:"agent-workflow-1",level:3},{value:"Expected Outcome",id:"expected-outcome-1",level:3},{value:"Example 3: Debug Data Quality Issue (Invalid Coordinates)",id:"example-3-debug-data-quality-issue-invalid-coordinates",level:2},{value:"Scenario",id:"scenario-2",level:3},{value:"Task",id:"task-2",level:3},{value:"Agent Workflow",id:"agent-workflow-2",level:3},{value:"Expected Outcome",id:"expected-outcome-2",level:3},{value:"Example 4: Analyze Slow Spatial Query",id:"example-4-analyze-slow-spatial-query",level:2},{value:"Scenario",id:"scenario-3",level:3},{value:"Task",id:"task-3",level:3},{value:"Agent Workflow",id:"agent-workflow-3",level:3},{value:"Expected Outcome",id:"expected-outcome-3",level:3},{value:"Example 5: Create Incremental Sync Job",id:"example-5-create-incremental-sync-job",level:2},{value:"Scenario",id:"scenario-4",level:3},{value:"Task",id:"task-4",level:3},{value:"Agent Workflow",id:"agent-workflow-4",level:3},{value:"Expected Outcome",id:"expected-outcome-4",level:3},{value:"How to Invoke the Agent",id:"how-to-invoke-the-agent",level:2},{value:"Best Practices for Working with the Agent",id:"best-practices-for-working-with-the-agent",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"data-engineer-agent---usage-examples",children:"Data Engineer Agent - Usage Examples"})}),"\n",(0,r.jsx)(n.p,{children:"This document provides real-world examples of how to use the Data Engineer Agent for the Chicago Traffic Crash Data Pipeline."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"The Data Engineer Agent is a specialized assistant that understands the Chicago Crashes Pipeline architecture, patterns, and best practices. It can help with ETL optimization, data quality debugging, schema design, performance tuning, and more."}),"\n",(0,r.jsx)(n.h2,{id:"example-1-optimize-etl-performance",children:"Example 1: Optimize ETL Performance"}),"\n",(0,r.jsx)(n.h3,{id:"scenario",children:"Scenario"}),"\n",(0,r.jsx)(n.p,{children:"The daily crash sync job is taking 45 minutes to complete, which is too slow for our operational needs."}),"\n",(0,r.jsx)(n.h3,{id:"task",children:"Task"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"User"}),': "The crash sync is taking too long. Can you optimize it?"']}),"\n",(0,r.jsx)(n.h3,{id:"agent-workflow",children:"Agent Workflow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Reviews Current Performance"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Reads ",(0,r.jsx)(n.a,{href:"../../src/services/sync_service.py:78-120",children:"src/services/sync_service.py"})," to understand the sync flow"]}),"\n",(0,r.jsx)(n.li,{children:"Checks batch size configuration in settings (currently 50K)"}),"\n",(0,r.jsx)(n.li,{children:"Reviews SODAClient rate limiting setup"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Analyzes Bottlenecks"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Examines ",(0,r.jsx)(n.a,{href:"../../src/etl/soda_client.py:100-150",children:"src/etl/soda_client.py"})," for rate limiter configuration"]}),"\n",(0,r.jsx)(n.li,{children:"Checks database connection pooling (pool_size=10, max_overflow=20)"}),"\n",(0,r.jsxs)(n.li,{children:["Reviews ",(0,r.jsx)(n.a,{href:"../../src/services/database_service.py:50-100",children:"src/services/database_service.py"})," upsert performance"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Checks Database Indexes"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Reviews ",(0,r.jsx)(n.a,{href:"../../src/models/crashes.py:80-120",children:"src/models/crashes.py"})," for existing indexes"]}),"\n",(0,r.jsxs)(n.li,{children:["Identifies composite index: ",(0,r.jsx)(n.code,{children:"ix_crashes_date_location"})]}),"\n",(0,r.jsx)(n.li,{children:"Verifies spatial indexes on geometry column"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Proposes Optimizations"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# 1. Increase concurrent requests\nsettings.api.max_concurrent = 10  # Up from 5\n\n# 2. Optimize batch size for upserts\nsettings.database.bulk_insert_size = 2000  # Up from 1000\n\n# 3. Add missing index for common queries\nIndex('ix_crashes_date_beat', 'crash_date', 'beat_of_occurrence')\n\n# 4. Use COPY protocol for bulk inserts\nsettings.database.use_copy = True\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Performance Expectations"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Concurrent requests: 30% improvement (30 minutes)"}),"\n",(0,r.jsx)(n.li,{children:"Bulk insert optimization: 15% improvement (25 minutes)"}),"\n",(0,r.jsx)(n.li,{children:"Combined: Sync should complete in ~20-25 minutes"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"expected-outcome",children:"Expected Outcome"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Identified specific bottlenecks in API calls and database upserts"}),"\n",(0,r.jsx)(n.li,{children:"Provided concrete configuration changes"}),"\n",(0,r.jsx)(n.li,{children:"Set realistic performance expectations"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"example-2-add-new-data-source-traffic-signals",children:"Example 2: Add New Data Source (Traffic Signals)"}),"\n",(0,r.jsx)(n.h3,{id:"scenario-1",children:"Scenario"}),"\n",(0,r.jsx)(n.p,{children:"The city wants to correlate crash data with nearby traffic signals to analyze whether signal malfunctions contribute to accidents."}),"\n",(0,r.jsx)(n.h3,{id:"task-1",children:"Task"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"User"}),': "Add traffic signals data from SODA endpoint ',(0,r.jsx)(n.code,{children:"3aav-uy2v.json"}),'"']}),"\n",(0,r.jsx)(n.h3,{id:"agent-workflow-1",children:"Agent Workflow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create SQLAlchemy Model"})}),"\n",(0,r.jsxs)(n.p,{children:["Creates ",(0,r.jsx)(n.code,{children:"src/models/traffic_signals.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from geoalchemy2 import Geometry\nfrom sqlalchemy import Column, String, Float, Integer, Index\nfrom src.models.base import Base, TimestampMixin\n\nclass TrafficSignal(Base, TimestampMixin):\n    \"\"\"Traffic signal locations and metadata.\"\"\"\n    __tablename__ = \"traffic_signals\"\n\n    signal_id = Column(String, primary_key=True)\n    latitude = Column(Float)\n    longitude = Column(Float)\n    geometry = Column(Geometry('POINT', srid=4326), nullable=True)\n\n    # Signal metadata\n    street_address = Column(String)\n    signal_type = Column(String)\n    num_phases = Column(Integer)\n    has_pedestrian_signal = Column(String)\n    last_inspection_date = Column(DateTime)\n\n    __table_args__ = (\n        Index('ix_traffic_signals_location', 'latitude', 'longitude'),\n        Index('ix_traffic_signals_type', 'signal_type'),\n    )\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Add Sanitization Method"})}),"\n",(0,r.jsxs)(n.p,{children:["Updates ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(7843).A+"",children:"src/validators/data_sanitizer.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def sanitize_traffic_signal_record(self, record: Dict[str, Any]) -> Dict[str, Any]:\n    \"\"\"Sanitize a traffic signal record.\n\n    Args:\n        record: Raw traffic signal record from API\n\n    Returns:\n        Sanitized record\n    \"\"\"\n    sanitized = {}\n\n    # Required fields\n    sanitized['signal_id'] = self._clean_string(record.get('signal_id'))\n\n    # Coordinates\n    sanitized['latitude'] = self._clean_coordinate(\n        record.get('latitude'),\n        coord_type='latitude'\n    )\n    sanitized['longitude'] = self._clean_coordinate(\n        record.get('longitude'),\n        coord_type='longitude'\n    )\n\n    # String fields\n    sanitized['street_address'] = self._clean_string(record.get('street_address'))\n    sanitized['signal_type'] = self._clean_string(record.get('signal_type'))\n    sanitized['has_pedestrian_signal'] = self._clean_string(\n        record.get('has_pedestrian_signal')\n    )\n\n    # Integer fields\n    sanitized['num_phases'] = self._clean_integer(record.get('num_phases'))\n\n    # Datetime fields\n    sanitized['last_inspection_date'] = self._parse_datetime(\n        record.get('last_inspection_date')\n    )\n\n    return sanitized\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Implement Upsert Method"})}),"\n",(0,r.jsxs)(n.p,{children:["Updates ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(1367).A+"",children:"src/services/database_service.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'def upsert_traffic_signal_records(self, records: List[Dict[str, Any]]) -> Dict[str, int]:\n    """Upsert traffic signal records using streaming pattern.\n\n    Args:\n        records: List of sanitized traffic signal records\n\n    Returns:\n        Dict with inserted and updated counts\n    """\n    from src.models.traffic_signals import TrafficSignal\n    return self._upsert_records(\n        records=records,\n        model_class=TrafficSignal,\n        pk_field=\'signal_id\',\n        prepare_func=self._prepare_traffic_signal_record\n    )\n\ndef _prepare_traffic_signal_record(self, record: Dict[str, Any]) -> Dict[str, Any]:\n    """Prepare traffic signal record for database insertion."""\n    prepared = {k: v for k, v in record.items() if k in TrafficSignal.__table__.columns}\n\n    # Create geometry from coordinates\n    if record.get(\'latitude\') and record.get(\'longitude\'):\n        from geoalchemy2.elements import WKTElement\n        point_wkt = f"POINT({record[\'longitude\']} {record[\'latitude\']})"\n        prepared[\'geometry\'] = WKTElement(point_wkt, srid=4326)\n\n    return prepared\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Update SyncService"})}),"\n",(0,r.jsxs)(n.p,{children:["Updates ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(1417).A+"",children:"src/services/sync_service.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'def _sanitize_batch(self, endpoint: str, batch: List[Dict]) -> List[Dict]:\n    """Route batch to appropriate sanitizer."""\n    if endpoint == "crashes":\n        return [self.sanitizer.sanitize_crash_record(r) for r in batch]\n    elif endpoint == "people":\n        return [self.sanitizer.sanitize_person_record(r) for r in batch]\n    elif endpoint == "vehicles":\n        return [self.sanitizer.sanitize_vehicle_record(r) for r in batch]\n    elif endpoint == "fatalities":\n        return [self.sanitizer.sanitize_fatality_record(r) for r in batch]\n    elif endpoint == "traffic_signals":  # NEW\n        return [self.sanitizer.sanitize_traffic_signal_record(r) for r in batch]\n    else:\n        return batch\n\ndef _persist_batch(self, endpoint: str, batch: List[Dict]) -> Dict[str, int]:\n    """Route batch to appropriate upsert method."""\n    if endpoint == "crashes":\n        return self.database_service.upsert_crash_records(batch)\n    elif endpoint == "people":\n        return self.database_service.upsert_person_records(batch)\n    elif endpoint == "vehicles":\n        return self.database_service.upsert_vehicle_records(batch)\n    elif endpoint == "fatalities":\n        return self.database_service.upsert_fatality_records(batch)\n    elif endpoint == "traffic_signals":  # NEW\n        return self.database_service.upsert_traffic_signal_records(batch)\n    else:\n        return {"inserted": 0, "updated": 0, "skipped": 0}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Update Configuration"})}),"\n",(0,r.jsxs)(n.p,{children:["Updates ",(0,r.jsx)(n.code,{children:"config/config.yaml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'api:\n  endpoints:\n    crashes: "https://data.cityofchicago.org/resource/85ca-t3if.json"\n    people: "https://data.cityofchicago.org/resource/u6pd-qa9d.json"\n    vehicles: "https://data.cityofchicago.org/resource/68nd-jvt3.json"\n    fatalities: "https://data.cityofchicago.org/resource/gzaz-isa6.json"\n    traffic_signals: "https://data.cityofchicago.org/resource/3aav-uy2v.json"  # NEW\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create Alembic Migration"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'alembic revision --autogenerate -m "Add traffic_signals table"\nalembic upgrade head\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Add Tests"})}),"\n",(0,r.jsxs)(n.p,{children:["Creates ",(0,r.jsx)(n.code,{children:"tests/test_traffic_signals.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import pytest\nfrom src.validators.data_sanitizer import DataSanitizer\n\ndef test_sanitize_traffic_signal_record():\n    sanitizer = DataSanitizer()\n\n    raw_record = {\n        'signal_id': 'SIG-001',\n        'latitude': '41.8781',\n        'longitude': '-87.6298',\n        'street_address': '123 Main St',\n        'signal_type': 'STANDARD',\n        'num_phases': '4',\n        'has_pedestrian_signal': 'Y'\n    }\n\n    sanitized = sanitizer.sanitize_traffic_signal_record(raw_record)\n\n    assert sanitized['signal_id'] == 'SIG-001'\n    assert sanitized['latitude'] == 41.8781\n    assert sanitized['longitude'] == -87.6298\n    assert sanitized['num_phases'] == 4\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"expected-outcome-1",children:"Expected Outcome"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["New ",(0,r.jsx)(n.code,{children:"traffic_signals"})," table with PostGIS geometry support"]}),"\n",(0,r.jsx)(n.li,{children:"Sanitization and validation following existing patterns"}),"\n",(0,r.jsx)(n.li,{children:"Streaming upsert capability"}),"\n",(0,r.jsx)(n.li,{children:"Full integration with existing ETL pipeline"}),"\n",(0,r.jsx)(n.li,{children:"Database migration tracked in Alembic"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"example-3-debug-data-quality-issue-invalid-coordinates",children:"Example 3: Debug Data Quality Issue (Invalid Coordinates)"}),"\n",(0,r.jsx)(n.h3,{id:"scenario-2",children:"Scenario"}),"\n",(0,r.jsx)(n.p,{children:"Data analysts report that some crash records appear on maps in unexpected locations, like the middle of Lake Michigan."}),"\n",(0,r.jsx)(n.h3,{id:"task-2",children:"Task"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"User"}),': "Some crashes have coordinates outside Chicago. Why is this happening?"']}),"\n",(0,r.jsx)(n.h3,{id:"agent-workflow-2",children:"Agent Workflow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Reviews Validation Logic"})}),"\n",(0,r.jsxs)(n.p,{children:["Reads ",(0,r.jsx)(n.a,{href:"../../src/validators/data_sanitizer.py:40-48",children:"src/validators/data_sanitizer.py:40-48"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'def _clean_coordinate(self, value: Any, coord_type: str) -> Optional[float]:\n    """Clean and validate coordinate value."""\n    coord = self._clean_float(value)\n    if coord is None:\n        return None\n\n    # Validate against Chicago bounds\n    if coord_type == \'latitude\':\n        if not (self.validation_settings.min_latitude <= coord <=\n                self.validation_settings.max_latitude):\n            logger.debug(f"Latitude {coord} outside valid range")\n            return None\n    elif coord_type == \'longitude\':\n        if not (self.validation_settings.min_longitude <= coord <=\n                self.validation_settings.max_longitude):\n            logger.debug(f"Longitude {coord} outside valid range")\n            return None\n\n    return coord\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Checks Validation Bounds"})}),"\n",(0,r.jsx)(n.p,{children:"Reviews configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"settings.validation.min_latitude = 41.6\nsettings.validation.max_latitude = 42.1\nsettings.validation.min_longitude = -87.95\nsettings.validation.max_longitude = -87.5\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Queries Database for Outliers"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Find records with out-of-bounds coordinates\nSELECT\n    crash_record_id,\n    crash_date,\n    latitude,\n    longitude,\n    ST_AsText(geometry) as point\nFROM crashes\nWHERE (latitude NOT BETWEEN 41.6 AND 42.1\n   OR longitude NOT BETWEEN -87.95 AND -87.5)\n  AND latitude IS NOT NULL\nLIMIT 10;\n\n-- Count total affected records\nSELECT COUNT(*) as out_of_bounds_count\nFROM crashes\nWHERE (latitude NOT BETWEEN 41.6 AND 42.1\n   OR longitude NOT BETWEEN -87.95 AND -87.5)\n  AND latitude IS NOT NULL;\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Analyzes Results"})}),"\n",(0,r.jsx)(n.p,{children:"Discovers:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"127 records with latitude/longitude outside bounds"}),"\n",(0,r.jsx)(n.li,{children:"These records still have latitude/longitude values BUT geometry is NULL"}),"\n",(0,r.jsx)(n.li,{children:"Reason: Validation happens AFTER field assignment in sanitize_crash_record()"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Identifies Root Cause"})}),"\n",(0,r.jsxs)(n.p,{children:["The issue is in ",(0,r.jsx)(n.a,{href:"../../src/validators/data_sanitizer.py:30-48",children:"src/validators/data_sanitizer.py:30-48"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# This returns the invalid coordinate to the sanitized dict\nsanitized['latitude'] = self._clean_coordinate(record.get('latitude'), 'latitude')\nsanitized['longitude'] = self._clean_coordinate(record.get('longitude'), 'longitude')\n"})}),"\n",(0,r.jsxs)(n.p,{children:["But in ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(1367).A+"",children:"src/services/database_service.py"}),", geometry creation is protected:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"if record.get('latitude') and record.get('longitude'):\n    # Geometry creation happens here - if coordinates are invalid,\n    # they were already set to None by _clean_coordinate()\n    point_wkt = f\"POINT({record['longitude']} {record['latitude']})\"\n    prepared['geometry'] = WKTElement(point_wkt, srid=4326)\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Explains Current Behavior"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Current system behavior"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Out-of-bounds coordinates return ",(0,r.jsx)(n.code,{children:"None"})," from ",(0,r.jsx)(n.code,{children:"_clean_coordinate()"})]}),"\n",(0,r.jsxs)(n.li,{children:["Sanitized record gets ",(0,r.jsx)(n.code,{children:"latitude=None, longitude=None"})]}),"\n",(0,r.jsx)(n.li,{children:"Database record is inserted with NULL lat/lon/geometry"}),"\n",(0,r.jsx)(n.li,{children:"These records exist but aren't queryable spatially"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why some appear on maps"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If validation bounds are too restrictive, valid Chicago suburbs are rejected"}),"\n",(0,r.jsx)(n.li,{children:"If coordinate swap occurs (lat/lon reversed), validation may pass incorrectly"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Proposes Solutions"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option A: Strict Validation (Recommended for data integrity)"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# In sync_service.py, filter out records with null coordinates\ndef _sanitize_batch(self, endpoint: str, batch: List[Dict]) -> List[Dict]:\n    sanitized = [self.sanitizer.sanitize_crash_record(r) for r in batch]\n    # Filter out records without valid coordinates\n    return [r for r in sanitized if r.get('latitude') and r.get('longitude')]\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option B: Flag for Review (Recommended for analysis)"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Add migration to add boolean field\nclass Crash(Base):\n    needs_geocoding = Column(Boolean, default=False)\n\n# In database_service.py\ndef _prepare_crash_record(self, record: Dict[str, Any]) -> Dict[str, Any]:\n    prepared = {...}\n    prepared['needs_geocoding'] = not (record.get('latitude') and record.get('longitude'))\n    return prepared\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option C: Expand Validation Bounds"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# If suburbs are valid crash locations, expand bounds:\nsettings.validation.min_latitude = 41.5  # Include more south suburbs\nsettings.validation.max_latitude = 42.2  # Include more north suburbs\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"expected-outcome-2",children:"Expected Outcome"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Identified that 127 records have invalid coordinates"}),"\n",(0,r.jsx)(n.li,{children:"Explained current validation behavior"}),"\n",(0,r.jsx)(n.li,{children:"Provided 3 options with different trade-offs"}),"\n",(0,r.jsx)(n.li,{children:"Recommended Option B (flagging) for transparency and future geocoding"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"example-4-analyze-slow-spatial-query",children:"Example 4: Analyze Slow Spatial Query"}),"\n",(0,r.jsx)(n.h3,{id:"scenario-3",children:"Scenario"}),"\n",(0,r.jsx)(n.p,{children:"A dashboard query that finds crashes within 500 meters of schools is timing out."}),"\n",(0,r.jsx)(n.h3,{id:"task-3",children:"Task"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"User"}),': "This spatial query is too slow: ',(0,r.jsx)(n.code,{children:"SELECT * FROM crashes WHERE ST_DWithin(geometry, $school_point, 500)"}),'"']}),"\n",(0,r.jsx)(n.h3,{id:"agent-workflow-3",children:"Agent Workflow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Checks Spatial Index"})}),"\n",(0,r.jsxs)(n.p,{children:["Verifies GiST index exists on geometry column in ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(6537).A+"",children:"src/models/crashes.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"geometry = Column(Geometry('POINT', srid=4326), nullable=True, index=True)\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Runs EXPLAIN ANALYZE"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"EXPLAIN ANALYZE\nSELECT crash_record_id, crash_date, ST_AsText(geometry)\nFROM crashes\nWHERE ST_DWithin(\n    geometry,\n    ST_SetSRID(ST_MakePoint(-87.6298, 41.8781), 4326),\n    500\n);\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Identifies Issue"})}),"\n",(0,r.jsx)(n.p,{children:"EXPLAIN shows:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Sequential Scan (not using GiST index)"}),"\n",(0,r.jsx)(n.li,{children:"Reason: ST_DWithin with distance in degrees, not meters"}),"\n",(0,r.jsx)(n.li,{children:"SRID 4326 uses degrees, but distance is specified in meters"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Explains Geographic Coordinate Issue"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"SRID 4326 (WGS84) uses degrees, not meters:\n- 1 degree latitude \u2248 111 km\n- 1 degree longitude \u2248 85 km at Chicago's latitude\n- 500 meters \u2248 0.0045 degrees\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Proposes Solutions"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option A: Use ST_DWithin with Geography (Recommended)"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT crash_record_id, crash_date\nFROM crashes\nWHERE ST_DWithin(\n    geometry::geography,  -- Cast to geography type\n    ST_SetSRID(ST_MakePoint(-87.6298, 41.8781), 4326)::geography,\n    500  -- Now in meters\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option B: Use Bounding Box First (Faster for large datasets)"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Create helper function to convert meters to degrees\nWITH bounds AS (\n    SELECT 500.0 / 111000.0 AS degree_buffer  -- Approximate\n)\nSELECT crash_record_id, crash_date\nFROM crashes, bounds\nWHERE geometry && ST_Expand(\n    ST_SetSRID(ST_MakePoint(-87.6298, 41.8781), 4326),\n    degree_buffer\n)\nAND ST_DWithin(\n    geometry::geography,\n    ST_SetSRID(ST_MakePoint(-87.6298, 41.8781), 4326)::geography,\n    500\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Option C: Store Geometry in Projected CRS"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Add projected geometry column in meters (EPSG:3857 - Web Mercator)\nclass Crash(Base):\n    geometry = Column(Geometry('POINT', srid=4326))\n    geometry_projected = Column(Geometry('POINT', srid=3857), index=True)\n\n# Query with projected coordinates\nSELECT crash_record_id\nFROM crashes\nWHERE ST_DWithin(\n    geometry_projected,\n    ST_Transform(ST_SetSRID(ST_MakePoint(-87.6298, 41.8781), 4326), 3857),\n    500  -- Meters in EPSG:3857\n);\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"expected-outcome-3",children:"Expected Outcome"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Identified SRID/distance unit mismatch"}),"\n",(0,r.jsx)(n.li,{children:"Explained degree vs meter confusion"}),"\n",(0,r.jsx)(n.li,{children:"Provided 3 solutions with performance trade-offs"}),"\n",(0,r.jsx)(n.li,{children:"Recommended Option B for immediate use, Option C for long-term optimization"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"example-5-create-incremental-sync-job",children:"Example 5: Create Incremental Sync Job"}),"\n",(0,r.jsx)(n.h3,{id:"scenario-4",children:"Scenario"}),"\n",(0,r.jsx)(n.p,{children:"Instead of syncing all crash data daily, we want to sync only records updated in the last 7 days."}),"\n",(0,r.jsx)(n.h3,{id:"task-4",children:"Task"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"User"}),': "Create a job that syncs only crashes from the last 7 days, running daily at 2 AM"']}),"\n",(0,r.jsx)(n.h3,{id:"agent-workflow-4",children:"Agent Workflow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Designs Job Configuration"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from src.models.jobs import JobType, RecurrenceType\nfrom src.services.job_service import JobService\n\njob_service = JobService()\n\njob = job_service.create_job(\n    name="Daily Incremental Crash Sync",\n    job_type=JobType.CUSTOM,\n    recurrence_type=RecurrenceType.DAILY,\n    next_run=datetime(2024, 1, 1, 2, 0, 0),  # 2 AM daily\n    timeout_seconds=1800,  # 30 minutes\n    max_retries=3,\n    custom_config={\n        "endpoints": ["crashes"],\n        "date_range": {\n            "type": "relative",\n            "days_back": 7\n        }\n    }\n)\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Explains Date Filtering"})}),"\n",(0,r.jsxs)(n.p,{children:["The SODAClient supports incremental sync using the ",(0,r.jsx)(n.code,{children:":updated_at"})," system field:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# In soda_client.py\nwhere_clause = f":updated_at >= \'{start_date}T00:00:00\'"\nurl = f"{base_url}?$where={where_clause}&$limit={batch_size}"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Creates API Endpoint"})}),"\n",(0,r.jsxs)(n.p,{children:["Adds to ",(0,r.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(4541).A+"",children:"src/api/routers/jobs.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@router.post("/jobs", response_model=JobResponse)\nasync def create_scheduled_job(\n    job_data: JobCreate,\n    db: Session = Depends(get_db)\n):\n    """Create a new scheduled job."""\n    job_service = JobService(db)\n    job = job_service.create_job(\n        name=job_data.name,\n        job_type=job_data.job_type,\n        recurrence_type=job_data.recurrence_type,\n        next_run=job_data.next_run,\n        timeout_seconds=job_data.timeout_seconds,\n        max_retries=job_data.max_retries,\n        custom_config=job_data.custom_config\n    )\n    return job\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Provides curl Example"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8000/jobs \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "name": "Daily Incremental Crash Sync",\n    "job_type": "CUSTOM",\n    "recurrence_type": "DAILY",\n    "next_run": "2024-01-15T02:00:00",\n    "timeout_seconds": 1800,\n    "max_retries": 3,\n    "custom_config": {\n      "endpoints": ["crashes"],\n      "date_range": {\n        "type": "relative",\n        "days_back": 7\n      }\n    }\n  }\'\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Documents Monitoring"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check job status\ncurl http://localhost:8000/jobs/summary\n\n# View execution history\ncurl http://localhost:8000/jobs/{job_id}/executions\n\n# Check specific execution logs\ncurl http://localhost:8000/jobs/{job_id}/executions/{execution_id}\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"expected-outcome-4",children:"Expected Outcome"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Created daily job configuration"}),"\n",(0,r.jsx)(n.li,{children:"Implemented relative date range (last 7 days)"}),"\n",(0,r.jsx)(n.li,{children:"Scheduled for 2 AM daily execution"}),"\n",(0,r.jsx)(n.li,{children:"Provided monitoring endpoints"}),"\n",(0,r.jsx)(n.li,{children:"Set appropriate timeout and retry limits"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"how-to-invoke-the-agent",children:"How to Invoke the Agent"}),"\n",(0,r.jsx)(n.p,{children:"The Data Engineer Agent can be invoked using the Claude Agent SDK or slash commands (specific syntax depends on your setup):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Example invocation (syntax may vary)\n/agent data-engineer "optimize the crash sync performance"\n\n# Or describe the task in natural language\n"Hey data engineer agent, can you help me debug why some crashes have invalid coordinates?"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices-for-working-with-the-agent",children:"Best Practices for Working with the Agent"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Be specific"}),': Instead of "fix the database", say "optimize the query that finds crashes near schools"']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Provide context"}),": Include error messages, query patterns, or performance metrics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ask for options"}),": The agent can present multiple solutions with trade-offs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Request explanations"}),': Ask "why" to understand the reasoning behind recommendations']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Follow patterns"}),": The agent knows existing code patterns - trust its guidance on consistency"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../../.claude/agents/data-engineer.md",children:"Agent Configuration"})," - Full agent definition and capabilities"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../../CLAUDE.md",children:"Project Documentation"})," - General project guide"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/documentation/architecture/overview",children:"Architecture Overview"})," - System architecture documentation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/documentation/architecture/services",children:"Service Documentation"})," - Detailed service descriptions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},7843:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/files/data_sanitizer-d42212b99e876f6aad6b4121ca260b08.py"},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);