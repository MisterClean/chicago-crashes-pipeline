"use strict";(self.webpackChunkchicago_crashes_pipeline_docs=self.webpackChunkchicago_crashes_pipeline_docs||[]).push([[544],{2274:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"operations/troubleshooting","title":"Troubleshooting","description":"Diagnose and resolve common issues with the pipeline.","source":"@site/docs/operations/troubleshooting.md","sourceDirName":"operations","slug":"/operations/troubleshooting","permalink":"/documentation/operations/troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/MisterClean/chicago-crashes-pipeline/tree/main/docs/operations/troubleshooting.md","tags":[],"version":"current","lastUpdatedAt":1758174418000,"sidebarPosition":3,"frontMatter":{"title":"Troubleshooting","sidebar_position":3,"description":"Diagnose and resolve common issues with the pipeline."},"sidebar":"guideSidebar","previous":{"title":"Deployment Guide","permalink":"/documentation/operations/deployment"},"next":{"title":"Development Environment","permalink":"/documentation/development/environment"}}');var o=s(4848),r=s(8453);const t={title:"Troubleshooting",sidebar_position:3,description:"Diagnose and resolve common issues with the pipeline."},l=void 0,a={},c=[{value:"Quick Diagnostics",id:"quick-diagnostics",level:2},{value:"Database Issues",id:"database-issues",level:2},{value:"&quot;Connection refused&quot; or authentication failures",id:"connection-refused-or-authentication-failures",level:3},{value:"PostGIS extension missing",id:"postgis-extension-missing",level:3},{value:"API Fails to Start",id:"api-fails-to-start",level:2},{value:"Sync Failures",id:"sync-failures",level:2},{value:"Slow Sync Performance",id:"slow-sync-performance",level:2},{value:"Admin Portal Errors",id:"admin-portal-errors",level:2},{value:"Spatial Layer Problems",id:"spatial-layer-problems",level:2},{value:"Reset the Environment",id:"reset-the-environment",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Use this checklist when something goes wrong. Commands assume you are in the project root."}),"\n",(0,o.jsx)(n.h2,{id:"quick-diagnostics",children:"Quick Diagnostics"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# API health\ncurl http://localhost:8000/health\n\n# Service status (Docker Compose)\ndocker compose -f docker/docker-compose.yml ps\n\n# Tail API logs\ndocker compose -f docker/docker-compose.yml logs -f app\n\n# Check database readiness\ndocker compose -f docker/docker-compose.yml exec postgres pg_isready -U postgres\n"})}),"\n",(0,o.jsx)(n.h2,{id:"database-issues",children:"Database Issues"}),"\n",(0,o.jsx)(n.h3,{id:"connection-refused-or-authentication-failures",children:'"Connection refused" or authentication failures'}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Ensure the container is running:","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker compose -f docker/docker-compose.yml ps postgres\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Validate credentials in ",(0,o.jsx)(n.code,{children:".env"})," and ",(0,o.jsx)(n.code,{children:"docker/docker-compose.yml"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Reset the database password and recreate the container if necessary:","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker compose -f docker/docker-compose.yml down postgres\ndocker compose -f docker/docker-compose.yml up -d postgres\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"postgis-extension-missing",children:"PostGIS extension missing"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'docker compose -f docker/docker-compose.yml exec postgres \\\n  psql -U postgres -d chicago_crashes -c "CREATE EXTENSION IF NOT EXISTS postgis;"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"api-fails-to-start",children:"API Fails to Start"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Import errors / missing dependencies"})," \u2013 rebuild the image or reinstall requirements:","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pip install -r requirements.txt\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Port already in use"})," \u2013 check and free port 8000:","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"lsof -i :8000\nkill <PID>\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Configuration errors"})," \u2013 validate ",(0,o.jsx)(n.code,{children:"config/config.yaml"})," (YAML syntax, environment placeholders). The API logs the offending key when configuration parsing fails."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"sync-failures",children:"Sync Failures"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Inspect the execution detail dialog in the admin portal for error messages."}),"\n",(0,o.jsxs)(n.li,{children:["Review ",(0,o.jsx)(n.code,{children:"logs/etl.log"})," for stack traces or rate-limit warnings."]}),"\n",(0,o.jsxs)(n.li,{children:["Confirm SODA API availability:","\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'curl "https://data.cityofchicago.org/resource/85ca-t3if.json?$limit=1"\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Retry with a smaller ",(0,o.jsx)(n.code,{children:"batch_size"})," or restricted endpoint list to isolate the failing dataset."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"slow-sync-performance",children:"Slow Sync Performance"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Provide an API token (",(0,o.jsx)(n.code,{children:"CHICAGO_API_TOKEN"}),") to raise rate limits."]}),"\n",(0,o.jsxs)(n.li,{children:["Temporarily reduce ",(0,o.jsx)(n.code,{children:"sync.max_concurrent"})," or ",(0,o.jsx)(n.code,{children:"sync.chunk_size"})," for environments with limited memory."]}),"\n",(0,o.jsx)(n.li,{children:"Run heavy backfills outside peak hours and disable non-essential scheduled jobs during the backfill."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"admin-portal-errors",children:"Admin Portal Errors"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Check browser developer tools for failed HTTP calls (most issues trace back to API availability or CORS settings)."}),"\n",(0,o.jsxs)(n.li,{children:["Ensure the API static mount points to ",(0,o.jsx)(n.code,{children:"src/static/admin"})," (custom deployments must include these assets)."]}),"\n",(0,o.jsx)(n.li,{children:"Refresh the page after redeploying the API to clear cached assets."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"spatial-layer-problems",children:"Spatial Layer Problems"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Confirm GeoPandas/Shapely dependencies are installed if you rely on shapefile ingestion."}),"\n",(0,o.jsx)(n.li,{children:"Ensure uploaded GeoJSON uses SRID 4326 by default; specify a different SRID in the upload form if needed."}),"\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"GET /spatial/layers"})," and ",(0,o.jsx)(n.code,{children:"GET /spatial/tables"})," to verify what the API sees."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"reset-the-environment",children:"Reset the Environment"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Stop containers and remove volumes\ndocker compose -f docker/docker-compose.yml down -v\n\n# Clear generated Python caches\nmake clean\n\n# Reinstall dependencies\npip install -r requirements.txt\n"})}),"\n",(0,o.jsx)(n.p,{children:"Document any new failure modes you encounter so they can be added to this playbook."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var i=s(6540);const o={},r=i.createContext(o);function t(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);